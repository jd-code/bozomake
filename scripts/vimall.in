#!/bin/sh
#
# $Id$
#
# Bozomake - (c) 2001-2002-2003-2004 Jean-Daniel Pauget

if [ "${1}" = "--version" ]
then
    echo "Bozomake's vimall version @VERSION@ - "'$Id$'
    echo "Bozomake @VERSION@ - (c) 2002-2003-2004 Jean-Daniel Pauget"
    echo
    exit 0
fi

SHORTPATH=`pwd | rev | cut -d'/' -f1 | rev`
/usr/local/bin/settitle "${SHORTPATH}"

if [ "${1}" ]
then
    if [ "${1}" = "-v" ]
    then
	echo "Bozomake's vimall version @VERSION@ - "'$Id$'
	echo "Bozomake @VERSION@ - (c) 2002-2003-2004 Jean-Daniel Pauget"
	exit 0
    fi

    if [ "${1}" = "-h" ]
    then
	echo 'vimall [-v] [-h] [-all] [-make]'
	exit 0
    fi

    if [ "${1}" = "-all" ]
    then
	echo -n "vimall scanning..."
	SORTLIST=`find . -type f -not -name ".*.swp" -not -path '*/.svn/*' -printf "%T@:%p\n" | grep -vw CVS | grep -v tags | grep -v TAGS | grep -v '/.deps/' | sort -t ':' -n -r | head -1000 | cut -d: -f2-`
	# LISTE=`find . -type f -not -name ".*.swp" -not -path '*/.svn/*' | grep -vw CVS | grep -v tags | grep -v TAGS | grep -v '/.deps/'`
	echo "done."
    else
	if [ "${1}" = "-make" ]
	then
	    echo -n "vimall scanning..."
	    SORTLIST=`find . -type f '(' -name "Make*" -o -name "conf" -o -name "*.in" -o -name "*.am" ')' '(' -not -path '*/.svn/*' -not -path '*/CVS/*' ')' -printf "%T@:%p\n" | sort -t ':' -n -r | head -1000 | cut -d: -f2-`
	    # LISTE=`find . -type f '(' -name "Make*" -o -name "conf" -o -name "*.in" -o -name "*.am" ')' '(' -not -path '*/.svn/*' -not -path '*/CVS/*' ')'`
	echo "done."
	else
	    echo "vimall: unknown option ${1}"
	    exit 1
	fi
    fi
else
    echo -n "vimall scanning..."
    SORTLIST=`find . '(' -type f -name "*.c" -o -name "*.h" -o -name "*.cpp" ')' '(' -not -path '*/.svn/*' -not -path '*/CVS/*' ')' -printf "%T@:%p\n" | sort -t ':' -n -r | head -1000 | cut -d: -f2-`
    # LISTE=`find . '(' -type f -name "*.c" -o -name "*.h" -o -name "*.cpp" ')' '(' -not -path '*/.svn/*' -not -path '*/CVS/*' ')'`
    echo "done."
fi

# this workaround for "command-line too long" symptom should rather use a combination of "find -print | sort" rather than ls
# LISTE=`echo "${LISTE}" | head -1000`
# 
# SORTLIST=`ls -ct ${LISTE}`
export SHELL=/usr/bin/tcsh

VA_TYPESVIM="NON"
if [ ! -f types.vim ]
then
    VA_TYPESVIM="OUI"
    maketags
fi

if [ -e .vim.prepend ]
then
    vi -s .vim.prepend ${SORTLIST}
else
    vi ${SORTLIST}
fi

if [ "${VA_TYPESVIM}" = "OUI" ]
then
    rm -f types.vim tags
fi

